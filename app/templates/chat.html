<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Super Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f4f4f4; }
    .chat-container {
      max-width: 600px;
      margin: 40px auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 80vh;
    }
    .chat-messages {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
    }
    .chat-input {
      display: flex;
      padding: 10px;
      border-top: 1px solid #ddd;
    }
    .chat-input input {
      flex: 1;
      border: none;
      padding: 10px;
      border-radius: 20px;
      background: #f0f0f0;
      margin-right: 10px;
    }
    .chat-input button {
      border: none;
      background: #007bff;
      color: white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
    }
    .message {
      margin-bottom: 10px;
    }
    .message.you {
      text-align: right;
    }
    .message .bubble {
      display: inline-block;
      padding: 10px 15px;
      border-radius: 20px;
      max-width: 70%;
    }
    .message.you .bubble {
      background: #007bff;
      color: white;
    }
    .message.other .bubble {
      background: #e4e6eb;
      color: black;
    }
  </style>
</head>
<body>

<div class="chat-container">
  <div class="chat-messages" id="chat-box"></div>
  
  <div class="chat-input">
    <input type="file" id="pdf-upload" style="display:none" accept="application/pdf">
<button class="me-2" onclick="document.getElementById('pdf-upload').click()" title="Upload PDF">
  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" class="bi bi-file-earmark-arrow-up" viewBox="0 0 16 16" style="background:#28a745; border-radius:50%; padding:5px;">
    <path d="M8 5a.5.5 0 0 1 .5.5V9.293l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.498.498 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 9.293V5.5A.5.5 0 0 1 8 5z"/>
    <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zM9.5 3V0H4a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4h-2.5a1 1 0 0 1-1-1z"/>
  </svg>
</button>

    <input type="text" id="message-input" placeholder="Type your message...">
    <button onclick="sendMessage()">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" class="bi bi-send" viewBox="0 0 16 16">
        <path d="M15.854.146a.5.5 0 0 0-.652-.022L.5 8l14.702 7.876a.5.5 0 0 0 .748-.437V.561a.5.5 0 0 0-.096-.415zM1.566 8 15 1.22v13.56L1.566 8z"/>
      </svg>
    </button>
  </div>
</div>

<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<script>
  const socket = io();

  const userId = Math.floor(Math.random() * 10000); // For demo purposes
  console.log("userIduserId",userId);
  
  socket.emit('join', { user_id: userId });
  socket.on('joined', (data) => {
    console.log(`User ${data.user_id} joined the chat`);
  });
  const chatBox = document.getElementById('chat-box');

  socket.on('message', (data) => {
    addMessage(data.message, data.sender === userId ? 'you' : 'other');
  });

  function sendMessage() {
    const input = document.getElementById('message-input');
    const msg = input.value.trim();
    if (!msg) return;
    socket.emit('send_message', { message: msg, sender: userId });
    addMessage(msg, 'you');
    input.value = '';
  }
 document.getElementById('pdf-upload').addEventListener('change', function () {
    const file = this.files[0];
    if (!file) return;

    const formData = new FormData();
    formData.append('file', file);

    fetch('/upload', {
      method: 'POST',
      body: formData
    })
    .then(res => res.json())
    .then(data => {
      addMessage(`📄 Uploaded PDF: ${file.name}`, 'you');
    })
    .catch(err => {
      console.error('Upload error', err);
      addMessage(`❌ Failed to upload ${file.name}`, 'you');
    });
  });
  
  socket.on('receive_message', (data) => {
    addMessage(data.message, data.sender);
  });

 function addMessage(text, sender) {
  const div = document.createElement('div');
  div.classList.add('message', sender);

  const now = new Date();
  const timestamp = now.toLocaleTimeString('en-IN', {
    hour12: false,
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });

  div.innerHTML = `
    <div class="bubble">
      ${text}
      <div style="font-size: 10px; text-align: right; margin-top: 4px; color: #666;">
        ${timestamp}
      </div>
    </div>
  `;

  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

</script>

</body>
</html>
